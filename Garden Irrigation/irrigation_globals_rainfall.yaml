
#==============
#=== Templates
#==============
template:
  - sensor:

      #=========================================================
      #=== Internal sensors that are based on the external ones
      #=== that have been user defined in the input texts.
      #===
      #=== These sensors are synchronised manually in an
      #=== automation when the external ones change
      #=========================================================
      
      #=== Daily Rainfall
      - name: Irrigation Sensor Rainfall Today
        unique_id: irrigation_sensor_rainfall_today
        state: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_today') %}
          {{ states(sensor_name) }}
        availability: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_today') %}
          {{ is_number(states(sensor_name)) }}
        icon: mdi:weather-rainy
        unit_of_measurement: mm
        device_class: precipitation

      - name: irrigation Sensor Rainfall Yesterday
        unique_id: irrigation_sensor_rainfall_yesterday
        state: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_yesterday') %}
          {{ states(sensor_name) }}
        availability: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_yesterday') %}
          {{ is_number(states(sensor_name)) }}
        icon: mdi:weather-rainy
        unit_of_measurement: mm
        device_class: precipitation


      #=== Rolling Rainfall
      - name: Irrigation Sensor Rainfall Last Twenty Four Hours
        unique_id: irrigation_sensor_rainfall_last_twenty_four_hours
        state: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_last_twenty_four_hours') %}
          {{ states(sensor_name) }}
        availability: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_last_twenty_four_hours') %}
          {{ is_number(states(sensor_name)) }}
        icon: mdi:weather-rainy
        unit_of_measurement: mm
        device_class: precipitation

      - name: Irrigation Sensor Rainfall Between 24 and 48 Hours Ago
        unique_id: irrigation_sensor_rainfall_between_24_and_48_hours_ago
        state: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_between_24_and_48_hours_ago') %}
          {{ states(sensor_name) }}
        availability: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_between_24_and_48_hours_ago') %}
          {{ is_number(states(sensor_name)) }}
        icon: mdi:weather-rainy
        unit_of_measurement: mm
        device_class: precipitation

      - name: Irrigation Sensor Rainfall Between 48 and 72 Hours Ago
        unique_id: irrigation_sensor_rainfall_between_48_and_72_hours_ago
        state: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_between_48_and_72_hours_ago') %}
          {{ states(sensor_name) }}
        availability: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_between_48_and_72_hours_ago') %}
          {{ is_number(states(sensor_name)) }}
        icon: mdi:weather-rainy
        unit_of_measurement: mm
        device_class: precipitation

      - name: Irrigation Sensor Rainfall Between 72 and 96 Hours Ago
        unique_id: irrigation_sensor_rainfall_between_72_and_96_hours_ago
        state: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_between_72_and_96_hours_ago') %}
          {{ states(sensor_name) }}
        availability: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_between_72_and_96_hours_ago') %}
          {{ is_number(states(sensor_name)) }}
        icon: mdi:weather-rainy
        unit_of_measurement: mm
        device_class: precipitation

      - name: Irrigation Sensor Rainfall Between 96 and 120 Hours Ago
        unique_id: irrigation_sensor_rainfall_between_96_and_120_hours_ago
        state: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_between_96_and_120_hours_ago') %}
          {{ states(sensor_name) }}
        availability: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_rainfall_between_96_and_120_hours_ago') %}
          {{ is_number(states(sensor_name)) }}
        icon: mdi:weather-rainy
        unit_of_measurement: mm
        device_class: precipitation


      #=== Forcast Rain
      - name: Irrigation Sensor Forecast Rain
        unique_id: irrigation_sensor_forecast_rain
        state: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_forecast_rain') %}
          {{ states(sensor_name) }}
        availability: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_forecast_rain') %}
          {{ is_number(states(sensor_name)) }}
        icon: mdi:weather-rainy
        unit_of_measurement: mm
        device_class: precipitation


  - binary_sensor:
      #=== Raining Now
      - name: Irrigation Sensor Raining Now
        unique_id: irrigation_sensor_raining_now
        state: >
          {% set sensor_name = states('input_text.irrigation_external_sensor_raining_now') %}
          {{ states(sensor_name) | default('off') }}
        icon: mdi:weather-pouring


#===================
#=== Input Booleans
#===================
input_boolean:

  irrigation_ignore_schedule_if_raining:
    name: Ignore schedules if it is raining
    icon: mdi:calendar-remove

  irrigation_rainfall_use_rolling_values:
    name: Use rolling 24hr values
    icon: mdi:timer-refresh


#================
#=== Input Texts
#================
input_text:

  #==============================
  #=== User defined sensor names
  #==============================
  #=== Sensor for rainfall today
  irrigation_external_sensor_rainfall_today:
    name: Rainfall Today Sensor
    icon: mdi:weather-pouring
    min: 0
    max: 100

  #=== Sensor for rainfall yesterday
  irrigation_external_sensor_rainfall_yesterday:
    name: Rainfall Yesterday Sensor
    icon: mdi:weather-pouring
    min: 0
    max: 100

  #=== Sensors for rolling rainfall
  irrigation_external_sensor_rainfall_last_twenty_four_hours:
    name: Rainfall Last Twenty Four Hours
    icon: mdi:weather-pouring
    min: 0
    max: 100

  irrigation_external_sensor_rainfall_between_24_and_48_hours_ago:
    name: Rainfall Between 24 and 48 Hours Ago
    icon: mdi:weather-pouring
    min: 0
    max: 100

  irrigation_external_sensor_rainfall_between_48_and_72_hours_ago:
    name: Rainfall Between 48 and 72 Hours Ago
    icon: mdi:weather-pouring
    min: 0
    max: 100

  irrigation_external_sensor_rainfall_between_72_and_96_hours_ago:
    name: Rainfall Between 72 and 96 Hours Ago
    icon: mdi:weather-pouring
    min: 0
    max: 100

  irrigation_external_sensor_rainfall_between_96_and_120_hours_ago:
    name: Rainfall Between 96 and 120 Hours Ago
    icon: mdi:weather-pouring
    min: 0
    max: 100


  #=== Sensor for raining now
  irrigation_external_sensor_raining_now:
    name: Raining Now
    icon: mdi:weather-pouring
    min: 0
    max: 100
  
  #=== Sensor for forecast rain
  irrigation_external_sensor_forecast_rain:
    name: Forecast Rain
    icon: mdi:weather-pouring
    min: 0
    max: 100


#==================
#=== Input_Numbers
#==================
input_number:

  #=== Rainfall Multiplier
  irrigation_rainfall_multiplier:
    name: Multiplier for rainfall
    min: 0
    max: 1
    step: 0.01
    icon: mdi:weather-rainy

  #=== Rainfall Days To Use
  irrigation_days_of_rainfall_history_used:
    name: Number of days history to use in calculations
    min: 0
    max: 4
    step: 1
    mode: box
    icon: mdi:calendar-range
    
  #=== Amount of rain before irrigation is stopped
  irrigation_rainfall_threshold:
    name: Rainfall threshold
    min: 1
    max: 20
    icon: mdi:weather-rainy
    mode: box
    unit_of_measurement: 'mm'


  #=== Rainfall History
  #=== (Today and yesterday are sensors)
  irrigation_rainfall_2:
    name: Two days ago
    min: 0
    max: 100
    icon: mdi:weather-rainy
    unit_of_measurement: 'mm'

  irrigation_rainfall_3:
    name: Three days ago
    min: 0
    max: 100
    icon: mdi:weather-rainy
    unit_of_measurement: 'mm'

  irrigation_rainfall_4:
    name: Four days ago
    min: 0
    max: 100
    icon: mdi:weather-rainy
    unit_of_measurement: 'mm'


  #=== Rainfall percentage to use
  irrigation_rainfall_percentage_1:
    name: Yesterday
    min: 0
    max: 100
    step: 5
    mode: box
    icon: mdi:weather-rainy
    unit_of_measurement: '%'

  irrigation_rainfall_percentage_2:
    name: Two days ago
    min: 0
    max: 100
    step: 5
    mode: box
    icon: mdi:weather-rainy
    unit_of_measurement: '%'

  irrigation_rainfall_percentage_3:
    name: Three days ago
    min: 0
    max: 100
    step: 5
    mode: box
    icon: mdi:weather-rainy
    unit_of_measurement: '%'

  irrigation_rainfall_percentage_4:
    name: Four days ago
    min: 0
    max: 100
    step: 5
    mode: box
    icon: mdi:weather-rainy
    unit_of_measurement: '%'


